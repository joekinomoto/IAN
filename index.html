<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IAN || Importadora de Autos del Norte">
  <title>IAN</title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/media/favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/vendor/slick.css">
  <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
  <link rel="stylesheet" href="assets/css/vendor/datetime.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.date.css">
  <link rel="stylesheet" href="assets/css/vendor/jquery.timepicker.min.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <style>
    /* Preloader */
    .loader {
      background: rgba(255,255,255,1);
      position: fixed;
      left: 0; top: 0; right: 0; bottom: 0;
      width: 100vw; height: 100vh;
      z-index: 99999;
      display: flex; align-items: center; justify-content: center;
      transition: opacity .4s;
    }
    .loader.hidden { opacity: 0; pointer-events: none; }

    /* Categorías: grid y tarjetas */
    .car-block {
      display: grid;
      grid-gap: 2.2rem;
      justify-content: center;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }
    @media (min-width: 1100px) {
      .car-block { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 992px) {
      .car-block { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 576px) {
      .car-block { grid-template-columns: repeat(3, 1fr); }
    }
    /* Imagen categorías */
    .car-content img {
      width: 64px; height: 64px;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      transition: filter .2s;
      background: transparent;
    }
    .car-content-label {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      margin-top: 0.5em;
      font-weight: 600;
      font-size: 1.5rem;
      line-height: 1.1;
    }
    .car-badge {
      position: absolute;
      right: -1.3em;
      top: -0.7em;
      min-width: 2em; height: 2em;
      background: #e60000;
      color: #fff; font-weight: 700; font-size: 1.25rem;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      z-index: 10; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      pointer-events: none; border: 2px solid #fff;
    }
    .car-content {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 16px 0 rgba(15,28,51,0.07);
      padding: 2.4rem 2rem 1.7rem 2rem;
      transition: border 0.2s, background 0.2s;
      cursor: pointer;
      border: 3px solid transparent;
      position: relative;
      text-align: center;
    }
    .car-content.selected,
    .car-content:hover {
      background: #FFF3CD;
      border: 3px solid #FFC107;
      /* sombra */
      box-shadow: 0 4px 24px 0 rgba(255,193,7,0.09);
    }
    .car-content.selected img,
    .car-content:hover img {
      filter: brightness(0.93) drop-shadow(0 0 2px #e2bc2c33);
    }
    @media (max-width: 576px) {
      .car-content-label { font-size: 1.1rem;}
      .car-badge { font-size: 1rem; min-width: 1.5em; height: 1.5em; right: -1.0em; top: -0.5em;}
    }

    /* Fix footer logo */
    .footer-logo {
      min-width: 180px; width: 180px; max-width: 220px;
    }
    @media (max-width: 600px) {
      .footer-logo { min-width: 100px; width: 120px; }
    }
    .footer-text {
      font-size: 1rem !important;
      font-weight: 400 !important;
    }
  </style>
</head>

<body class="tt-smooth-scroll">
  <!-- preloader Start -->
  <div class="loader" id="preloader">
    <svg class="car" width="102" height="40" xmlns="http://www.w3.org/2000/svg">
      <g transform="translate(2 1)" stroke="#002742" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
        <path class="car__body" d="M47.293 2.375C52.927.792 54.017.805 54.017.805c2.613-.445 6.838-.337 9.42.237l8.381 1.863c2.59.576 6.164 2.606 7.98 4.531l6.348 6.732 6.245 1.877c3.098.508 5.609 3.431 5.609 6.507v4.206c0 .29-2.536 4.189-5.687 4.189H36.808c-2.655 0-4.34-2.1-3.688-4.67 0 0 3.71-19.944 14.173-23.902zM36.5 15.5h54.01" stroke-width="3"/>
        <ellipse class="car__wheel--left" stroke-width="3.2" fill="#FFF" cx="83.493" cy="30.25" rx="6.922" ry="6.808"/>
        <ellipse class="car__wheel--right" stroke-width="3.2" fill="#FFF" cx="46.511" cy="30.25" rx="6.922" ry="6.808"/>
        <path class="car__line car__line--top" d="M22.5 16.5H2.475" stroke-width="3"/>
        <path class="car__line car__line--middle" d="M20.5 23.5H.4755" stroke-width="3"/>
        <path class="car__line car__line--bottom" d="M25.5 9.5h-19" stroke-width="3"/>
      </g>
    </svg>
  </div>
  <!-- preloader END -->

  <div id="scroll-container">
    <!-- HEADER MENU START -->
    <header class="header">
      <div class="container-fluid">
        <nav class="navigation d-flex align-items-center justify-content-between py-16">
          <a href="index.html" class="d-flex align-items-center">
            <img src="assets/media/logo.png" alt="logo" class="header-logo">
          </a>
          <div class="menu-button-right">
            <div class="main-menu__nav">
              <ul class="main-menu__list">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="about.html">About Us</a></li>
                <li class="dropdown">
                  <a href="javascript:void(0); ">Listing</a>
                  <ul>
                    <li><a href="cars.html">Cars</a></li>
                    <li><a href="car-details.html">Cars Details</a></li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a href="javascript:void(0); ">Pages </a>
                  <ul>
                    <li><a href="blogs.html">Blogs</a></li>
                    <li><a href="blogs-2.html">Blogs-2</a></li>
                    <li><a href="blog-list.html">Blog List</a></li>
                    <li><a href="blog-list-2.html">Blog List-2</a></li>
                    <li><a href="blog-detail.html">Blog Detail</a></li>
                    <li><a href="booking.html">Booking Now</a></li>
                    <li><a href="404.html">404 Page</a></li>
                    <li><a href="faq's.html">Faq's</a></li>
                  </ul>
                </li>
                <li><a href="contact.html">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="main-menu__right">
            <div class="search-heart-icon d-sm-flex d-none align-items-center gap-24"></div>
            <a href="" class="d-xl-none d-flex main-menu__toggler mobile-nav__toggler">
              <img src="assets/media/icons/menu-2.png" alt="">
            </a>
          </div>
        </nav>
      </div>
    </header>
    <!-- HEADER MENU END -->

    <section class="hero-banner">
      <div class="container-fluid">
        <div class="hero-content">
          <div class="heading text-lg-start text-center my-4">
            <p class="mb-4 text-white">¿Estás listo para elegir el vehículo que te llevará a la libertad?</p>
            <h4 class="text-white">Elige la libertad. Elige tu vehículo.</h4>
          </div>
        </div>
      </div>
    </section>

    <!-- CATEGORÍAS DE AUTOS CON BURBUJA -->
    <section class="hero-cars-block">
      <div class="container-fluid">
        <div class="car-block" id="car-categories-block">
          <!-- JS llena aquí las categorías con burbuja -->
        </div>
      </div>
    </section>

    <!-- BLOG Section START -->
    <section class="blog-sec py-80">
      <div class="container-fluid position-relative">
        <div class="d-flex flex-wrap row-gap-4 justify-content-lg-between justify-content-center align-items-end mb-48">
          <div class="heading text-lg-start text-center"><h4 class="black"></h4></div>
          <nav class="nav-cotent position-relative" style="z-index:1;">
            <div style="position:relative;display:inline-block;">
              <div class="tab-bg-text-wrapper" style="position:relative;">
                <div id="tab-bg-text" class="tab-bg-text" style="position:absolute;inset:0;z-index:0;pointer-events:none;display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:clamp(2rem,7vw,5rem);font-weight:900;color:#b0b0b0;opacity:0.25;transition:all 0.4s;line-height:1;white-space:nowrap;"></div>
                <div class="d-flex gap-16 align-items-center position-relative" style="z-index:1;">
                  <div class="nav nav-tabs active reviews" id="nav-tab" role="tablist">
                    <div class="nav-link discription" id="nav-desc-tab" data-bs-toggle="tab" data-bs-target="#nav-desc"
                      role="tab" aria-controls="nav-desc" aria-selected="false">
                      <div>
                        <h6 class="fw-500">Disponibles</h6>
                      </div>
                    </div>
                    <div class="nav-line"></div>
                    <div class="nav-link active reviews" id="nav-review-tab2" data-bs-toggle="tab"
                      data-bs-target="#nav-review" role="tab" aria-controls="nav-review" aria-selected="true">
                      <div>
                        <h6 class="fw-500">Vendidos</h6>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
        <div class="description-wrapper mb-48">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade" id="nav-desc" role="tabpanel" aria-labelledby="nav-desc-tab">
              <div class="row row-gap-4" id="row-disponibles"></div>
            </div>
            <div class="tab-pane fade active show" id="nav-review" role="tabpanel" aria-labelledby="nav-review-tab2">
              <div class="row row-gap-4" id="row-vendidos"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- BLOG ARTICLE Section END -->

    <!-- FOOTER -->
    <footer class="footer">
      <div>
        <div class="footer-wrapper d-flex flex-wrap justify-content-between align-items-center" style="padding: 0 2vw;">
          <div>
            <img src="assets/media/footer-logo.png" alt="" class="footer-logo my-2">
          </div>
          <div>
            <p class="footer-text mb-2" style="color: #fff;">IAN © 2025 - Todos los derechos reservados.</p>
          </div>
        </div>
      </div>
    </footer>
    <!-- FOOTER END -->
  </div>

  <!-- Jquery y plugins (según tu template) -->
  <script src="assets/js/vendor/bootstrap.min.js"></script>
  <script src="assets/js/vendor/jquery-3.6.3.min.js"></script>
  <script src="assets/js/vendor/slick.min.js"></script>
  <script src="assets/js/vendor/jquery-validator.js"></script>
  <script src="assets/js/vendor/calendar/popper.min.js"></script>
  <script src="assets/js/vendor/calendar/picker.js"></script>
  <script src="assets/js/vendor/calendar/picker.date.js"></script>
  <script src="assets/js/vendor/jquery.timepicker.min.js"></script>
  <script src="assets/js/date.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
    // ====== SUPABASE DATOS ======
    const SUPABASE_URL = 'https://jxtpcfjmpahguudaksld.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4dHBjZmptcGFoZ3V1ZGFrc2xkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjE4NDgsImV4cCI6MjA2NzMzNzg0OH0.5vSPaIM3cwQGyX0xYnaoRMPkdHIdBq_O6rHqwZWKB0Q';

    // Contenedores
    const disponiblesCont = document.getElementById('row-disponibles');
    const vendidosCont = document.getElementById('row-vendidos');
    const carCatBlock = document.getElementById('car-categories-block');
    let categorias = []; // del api ocate
    let autos = [];      // del api ocars
    let categoriaSeleccionada = null; // para el filtro activo
    let tabActual = 'disponibles'; // disponibles o vendidos

    // Preloader
    function ocultarPreloader() {
      setTimeout(() => {
        document.getElementById('preloader').classList.add('hidden');
      }, 450);
    }

    // Trae categorías del API ocate
    async function cargarCategorias() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/ocate?select=*`, {
        headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
      });
      let data = await res.json();
      categorias = data.filter(c => c.INACTIVE === false);
      // Ordenar por type DESC y luego categoria ASC
      categorias.sort((a, b) => {
        if (a.type === b.type) return a.categoria.localeCompare(b.categoria);
        return b.type.localeCompare(a.type);
      });
    }

    // Trae autos del API ocars (solo activos)
    async function cargarAutos() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/ocars?select=*`, {
        headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
      });
      let data = await res.json();
      autos = data.filter(a => a.INACTIVE === false);
    }

    // Renderiza las tarjetas de autos
    function renderAutos() {
      // Ordena los autos según el orden de categorías
      let ordenCategorias = categorias.map(c => c.categoria);
      let mostrarAutos = autos.filter(a =>
        (tabActual === 'disponibles' ? a.vendido === false : a.vendido === true) &&
        (!categoriaSeleccionada || a.categoria === categoriaSeleccionada)
      );
      // Ordena autos según la categoría y luego por id DESC
      mostrarAutos.sort((a, b) => {
        let catA = ordenCategorias.indexOf(a.categoria);
        let catB = ordenCategorias.indexOf(b.categoria);
        if (catA !== catB) return catA - catB;
        return b.id - a.id;
      });

      const htmls = mostrarAutos.map(a => autoCard(a, tabActual === 'vendidos')).join('');
      const vacio = `<div class="col-12"><p>No hay autos ${tabActual === 'disponibles' ? 'disponibles' : 'vendidos'}.</p></div>`;
      if (tabActual === 'disponibles') disponiblesCont.innerHTML = htmls || vacio;
      else vendidosCont.innerHTML = htmls || vacio;
    }

    // Renderiza las categorías con burbujas
    function renderCategorias() {
      // Cuenta autos disponibles x categoría
      const countByCat = {};
      for (const a of autos) {
        if (!a.vendido && !a.INACTIVE) countByCat[a.categoria] = (countByCat[a.categoria] || 0) + 1;
      }
      carCatBlock.innerHTML = categorias.map(cat => {
        const qty = countByCat[cat.categoria] || 0;
        return `
          <div class="car-content${categoriaSeleccionada === cat.categoria ? ' selected' : ''}" data-cat="${cat.categoria}">
            <div style="position:relative;">
              <img src="${cat.imagen}" alt="" draggable="false">
              ${qty > 0 ? `<span class="car-badge">${qty}</span>` : ''}
            </div>
            <div class="car-content-label">${cat.categoria}</div>
          </div>
        `;
      }).join('');
      // Click handlers
      Array.from(carCatBlock.children).forEach(node => {
        node.onclick = function() {
          const sel = this.getAttribute('data-cat');
          if (categoriaSeleccionada === sel) {
            categoriaSeleccionada = null;
          } else {
            categoriaSeleccionada = sel;
          }
          renderCategorias();
          renderAutos();
        };
      });
    }

    // Renderiza una tarjeta de auto
    function autoCard(auto, vendido = false) {
      return `
        <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-6 col-sm-12">
          <div class="blog-1">
            <div class="blog-img" style="position:relative;">
              ${vendido ? `<span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);background:rgba(220,53,69,0.85);color:#fff;font-size:clamp(1.5rem,4vw,2rem);font-weight:900;padding:0.5em 1.7em;border-radius:0.3em;z-index:2;pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);letter-spacing:0.1em;white-space:nowrap;">VENDIDO</span>` : ''}
              <a href="car-details.html">
                <img src="${auto.imagen || 'assets/media/blog/blog-1.jpg'}" alt="${auto.marca || ''} ${auto.modelo || ''}" style="${vendido ? 'opacity:0.25;' : ''}">
              </a>
            </div>
            <div class="blog-content">
              <p class="subtitle black mb-4">${auto.categoria || ''}</p>
              <div class="d-flex align-items-center justify-content-between mb-36">
                <a href="car-details.html" class="h6 hover-content fw-500 black">${(auto.marca || '') + ' ' + (auto.modelo || '')}</a>
                <h5 class="fw-600 color-primary">${auto.precio || ''}</h5>
              </div>
              <div class="d-flex align-items-center justify-content-between mb-36">
                <div>
                  <div class="d-flex align-items-center gap-16 mb-16">
                    <img src="assets/media/icons/manual-transmission.png" alt="">
                    <p class="fw-600 black">${auto.transmision || ''}</p>
                  </div>
                  <div class="d-flex align-items-center gap-16">
                    <img src="assets/media/icons/disc-brake.png" alt="">
                    <p class="fw-600 black">${auto.descripcion || ''}</p>
                  </div>
                </div>
                <div>
                  <div class="d-flex align-items-center gap-16 mb-16">
                    <img src="assets/media/icons/speedometer.png" alt="">
                    <p class="fw-600 black">${auto.kms || ''} Kms</p>
                  </div>
                  <div class="d-flex align-items-center gap-16">
                    <img src="assets/media/icons/fuel.png" alt="">
                    <p class="fw-600 black">${auto.combustible || ''}</p>
                  </div>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-between mt-2">
                <div>
                  <span class="fw-600">${auto.year ? `<span style="font-weight: bold;">${auto.year}</span>` : ''}</span>
                </div>
                <div>
                  ${!vendido ? `
                    <a href="https://wa.me/502${auto.whatsapp || ''}" target="_blank" class="hover-content" title="Contáctame por WhatsApp" style="text-decoration:none;display:flex;align-items:center;gap:4px;">
                      <span style="color:#232323;">Contáctanos:</span>
                      <i class="fa-brands fa-whatsapp" style="color:#25D366;font-size:2em;margin-left:4px;"></i>
                    </a>
                  ` : `
                    <span style="color:#aaa;display:flex;align-items:center;gap:4px;">Contáctanos:
                      <i class="fa-brands fa-whatsapp" style="color:#bbb;font-size:2em;margin-left:4px;pointer-events:none;opacity:0.5;"></i>
                    </span>
                  `}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // --------- Control visual de pestañas ---------
    function updateTabBgText() {
      var descTab = document.getElementById('nav-desc-tab');
      var reviewTab = document.getElementById('nav-review-tab2');
      var bg = document.getElementById('tab-bg-text');
      if (!bg) return;
      if (descTab.classList.contains('active')) {
        bg.textContent = 'DISPONIBLES';
        tabActual = 'disponibles';
      } else if (reviewTab.classList.contains('active')) {
        bg.textContent = 'VENDIDOS';
        tabActual = 'vendidos';
      }
      renderAutos();
    }
    var descTab = document.getElementById('nav-desc-tab');
    var reviewTab = document.getElementById('nav-review-tab2');
    descTab && descTab.addEventListener('click', function () {
      descTab.classList.add('active');
      reviewTab.classList.remove('active');
      updateTabBgText();
    });
    reviewTab && reviewTab.addEventListener('click', function () {
      reviewTab.classList.add('active');
      descTab.classList.remove('active');
      updateTabBgText();
    });

    // Inicia todo
    async function inicializar() {
      await cargarCategorias();
      await cargarAutos();
      renderCategorias();
      renderAutos();
      updateTabBgText();
      ocultarPreloader();
    }
    document.addEventListener('DOMContentLoaded', inicializar);
  </script>
</body>
</html>
