<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IAN || Importadora de Autos del Norte">
  <title>IAN</title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/media/favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/vendor/slick.css">
  <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
  <link rel="stylesheet" href="assets/css/vendor/datetime.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.date.css">
  <link rel="stylesheet" href="assets/css/vendor/jquery.timepicker.min.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <style>
    .car-block {
      display: flex;
      flex-wrap: wrap;
      gap: 32px 28px;
      justify-content: center;
      margin-bottom: 32px;
      padding-bottom: 0.5rem;
      width: 100%;
    }
    .car-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 3px 18px 0 rgba(30,37,62,.08);
      padding: 30px 30px 18px 30px;
      min-width: 210px;
      min-height: 140px;
      max-width: 250px;
      flex: 1 0 210px;
      position: relative;
      margin-bottom: 0.25rem;
      transition: box-shadow .18s, border-color .2s, background .2s;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .car-content.selected,
    .car-content:active {
      background: #fff8e1;
      border: 2px solid #FFCA42;
      box-shadow: 0 4px 32px 0 rgba(255,202,66,.20);
    }
    .car-content-label {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      margin-top: 0.5em;
      font-weight: 600;
      font-size: 1.5rem;
      line-height: 1.1;
      text-align: center;
      min-height: 2.4rem;
    }
    .car-badge {
      position: absolute;
      right: -1.6em;
      top: -0.8em;
      min-width: 2em;
      height: 2em;
      background: #e60000;
      color: #fff;
      font-weight: 700;
      font-size: 1.25rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      pointer-events: none;
      border: 2px solid #fff;
    }
    @media (max-width: 1100px) {
      .car-block { gap: 18px 14px; }
      .car-content { min-width: 170px; max-width: 200px; padding: 22px 8px 12px 8px;}
      .car-content-label { font-size: 1.05rem; }
    }
    @media (max-width: 750px) {
      .car-block { gap: 12px 10px; }
      .car-content { min-width: 140px; max-width: 180px; padding: 15px 6px 10px 6px;}
    }
    @media (max-width: 600px) {
      .car-block { gap: 10px 8px; }
      .car-content { min-width: 90vw; max-width: 99vw; width: 98vw;}
    }
    @media (max-width: 420px) {
      .car-content { padding: 10px 2vw 6px 2vw; }
      .car-content-label { font-size: 1rem; }
    }
    /* Burbuja chica para mobile */
    @media (max-width: 576px) {
      .car-badge { font-size: 1rem; min-width: 1.4em; height: 1.4em; right: -1.1em; top: -0.5em;}
      .car-content-label { font-size: 1.03rem;}
    }
  </style>
</head>
<body class="tt-smooth-scroll">

  <!-- HEADER MENU START -->
  <header class="header">
    <div class="container-fluid">
      <nav class="navigation d-flex align-items-center justify-content-between py-16">
        <a href="index.html" class="d-flex align-items-center">
          <img src="assets/media/logo.png" alt="/logo" class="header-logo">
        </a>
        <div class="menu-button-right">
          <div class="main-menu__nav">
            <ul class="main-menu__list">
              <li><a href="index.html" class="active">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Listing</a>
                <ul>
                  <li> <a href="cars.html">Cars</a></li>
                  <li> <a href="car-details.html">Cars Details</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Pages </a>
                <ul>
                  <li><a href="blogs.html">Blogs</a></li>
                  <li><a href="blogs-2.html">Blogs-2</a></li>
                  <li><a href="blog-list.html">Blog List</a></li>
                  <li><a href="blog-list-2.html">Blog List-2</a></li>
                  <li><a href="blog-detail.html">Blog Detail</a></li>
                  <li><a href="booking.html">Booking Now</a></li>
                  <li><a href="404.html">404 Page</a></li>
                  <li><a href="faq's.html">Faq's</a></li>
                </ul>
              </li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>
        </div>
        <div class="main-menu__right">
          <div class="search-heart-icon d-sm-flex d-none align-items-center gap-24"></div>
          <a href="" class="d-xl-none d-flex main-menu__toggler mobile-nav__toggler">
            <img src="assets/media/icons/menu-2.png" alt="">
          </a>
        </div>
      </nav>
    </div>
  </header>
  <!-- HEADER MENU END -->

  <section class="hero-banner">
    <div class="container-fluid">
      <div class="hero-content">
        <div class="heading text-lg-start text-center my-4">
          <p class="mb-4 text-white">¿Estás listo para elegir el vehículo que te llevará a la libertad?</p>
          <h4 class="text-white">Elige la libertad. Elige tu vehículo.</h4>
        </div>
      </div>
    </div>
  </section>

  <!-- CATEGORÍAS DE AUTOS CON BURBUJA -->
  <section class="hero-cars-block">
    <div class="container-fluid">
      <div class="car-block" id="car-categories-block">
        <!-- JS llena aquí las categorías con burbuja -->
      </div>
    </div>
  </section>

  <!-- BLOG Section START -->
  <section class="blog-sec py-80">
    <div class="container-fluid position-relative">
      <div class="d-flex flex-wrap row-gap-4 justify-content-lg-between justify-content-center align-items-end mb-48">
        <div class="heading text-lg-start text-center">
          <h4 class="black"></h4>
        </div>
        <nav class="nav-cotent position-relative" style="z-index:1;">
          <div style="position:relative;display:inline-block;">
            <div class="tab-bg-text-wrapper" style="position:relative;">
              <div id="tab-bg-text" class="tab-bg-text" style="position:absolute;inset:0;z-index:0;pointer-events:none;display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:clamp(2rem,7vw,5rem);font-weight:900;color:#b0b0b0;opacity:0.25;transition:all 0.4s;line-height:1;white-space:nowrap;">
              </div>
              <div class="d-flex gap-16 align-items-center position-relative" style="z-index:1;">
                <div class="nav nav-tabs active reviews" id="nav-tab" role="tablist">
                  <div class="nav-link discription" id="nav-desc-tab" data-bs-toggle="tab" data-bs-target="#nav-desc"
                    role="tab" aria-controls="nav-desc" aria-selected="false">
                    <div>
                      <h6 class="fw-500">Disponibles</h6>
                    </div>
                  </div>
                  <div class="nav-line"></div>
                  <div class="nav-link active reviews" id="nav-review-tab2" data-bs-toggle="tab"
                    data-bs-target="#nav-review" role="tab" aria-controls="nav-review" aria-selected="true">
                    <div>
                      <h6 class="fw-500">Vendidos</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
      <div class="description-wrapper mb-48">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade" id="nav-desc" role="tabpanel" aria-labelledby="nav-desc-tab">
            <div class="row row-gap-4">
              <!-- Autos disponibles se llenan por JS -->
            </div>
          </div>
          <div class="tab-pane fade active show" id="nav-review" role="tabpanel" aria-labelledby="nav-review-tab2">
            <div class="row row-gap-4">
              <!-- Autos vendidos se llenan por JS -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- BLOG ARTICLE Section END -->

  <!-- FOOTER -->
  <footer class="footer">
    <div>
      <div class="footer-wrapper d-flex align-items-center justify-content-between px-4 py-2" style="min-height:60px;">
        <div class="footer-sec-1">
          <img style="min-width:110px;max-width:140px;width:120px;" src="assets/media/footer-logo.png" alt="">
        </div>
        <div class="footer-sec-2">
          <p class="fw-400 lightest-gray mb-0" style="font-size: 1rem; letter-spacing:0.03em;">IAN © 2025 - Todos los derechos reservados.</p>
        </div>
      </div>
    </div>
  </footer>
  <!-- FOOTER END -->

  <!-- Jquery y plugins (según tu template) -->
  <script src="assets/js/vendor/bootstrap.min.js"></script>
  <script src="assets/js/vendor/jquery-3.6.3.min.js"></script>
  <script src="assets/js/vendor/slick.min.js"></script>
  <script src="assets/js/vendor/jquery-validator.js"></script>
  <script src="assets/js/vendor/calendar/popper.min.js"></script>
  <script src="assets/js/vendor/calendar/picker.js"></script>
  <script src="assets/js/vendor/calendar/picker.date.js"></script>
  <script src="assets/js/vendor/jquery.timepicker.min.js"></script>
  <script src="assets/js/date.js"></script>
  <script src="assets/js/app.js"></script>

  <!-- SCRIPT DINÁMICO -->
  <script>
    const SUPABASE_URL = 'https://jxtpcfjmpahguudaksld.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4dHBjZmptcGFoZ3V1ZGFrc2xkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjE4NDgsImV4cCI6MjA2NzMzNzg0OH0.5vSPaIM3cwQGyX0xYnaoRMPkdHIdBq_O6rHqwZWKB0Q';

    // Estado
    let categoriesFromAPI = [];
    let autosData = [];
    let selectedCategory = null;
    let tabSelected = "disponibles"; // 'disponibles' o 'vendidos'

    const disponiblesCont = document.querySelector('#nav-desc .row');
    const vendidosCont = document.querySelector('#nav-review .row');
    const carCatBlock = document.getElementById('car-categories-block');

    function autoCard(auto, vendido = false) {
      // Formatea el teléfono
      function formatPhone(number) {
        if (!number) return '';
        let str = number.toString();
        if (str.length === 8) return `(+502) ${str.slice(0,4)}-${str.slice(4)}`;
        return str;
      }
      return `
      <div class="col-xxl-3 col-xl-4 col-sm-6">
        <div class="blog-1">
          <div class="blog-img" style="position:relative;">
            ${vendido ? `<span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);background:rgba(220,53,69,0.85);color:#fff;font-size:clamp(1.5rem,4vw,2rem);font-weight:900;padding:0.5em 1.7em;border-radius:0.3em;z-index:2;pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);letter-spacing:0.1em;white-space:nowrap;">VENDIDO</span>` : ''}
            <a href="car-details.html">
              <img src="${auto.imagen || 'assets/media/blog/blog-1.jpg'}" alt="${auto.nombre || ''}" style="${vendido ? 'opacity:0.25;' : ''}">
            </a>
          </div>
          <div class="blog-content">
            <p class="subtitle black mb-4">${auto.categoria || ''}</p>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <a href="car-details.html" class="h6 hover-content fw-500 black">${auto.nombre || ''}</a>
              <h5 class="fw-600 color-primary">${auto.precio || ''}</h5>
            </div>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/manual-transmission.png" alt="">
                  <p class="fw-600 black">${auto.transmision || ''}</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/disc-brake.png" alt="">
                  <p class="fw-600 black">${auto.descripcion || ''}</p>
                </div>
              </div>
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/speedometer.png" alt="">
                  <p class="fw-600 black">${auto.kms || ''} Kms</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/fuel.png" alt="">
                  <p class="fw-600 black">${auto.combustible || ''}</p>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                ${vendido
                  ? `<span style="color:#E60000;font-weight:700;">VENDIDO</span>`
                  : `<span style="font-weight:400;">Contactanos: </span>
                     <span class="fw-600">${formatPhone(auto.whatsapp) || ''}</span>`
                }
              </div>
              <div>
                ${vendido
                  ? `<i class="fa-brands fa-whatsapp" style="color:#b0b0b0;opacity:.7;font-size:2em;pointer-events:none;cursor:default;"></i>`
                  : `<a href="https://wa.me/502${auto.whatsapp || ''}?text=Hola,%20me%20interesa%20el%20vehículo:%20${encodeURIComponent(auto.nombre || '')}" target="_blank" class="text-decoration-underline p hover-content" title="Contáctame por WhatsApp">
                      <i class="fa-brands fa-whatsapp" style="color:#25D366;font-size:2em;"></i>
                    </a>`
                }
              </div>
            </div>
          </div>
        </div>
      </div>
      `;
    }

    // RENDERIZA LAS CATEGORÍAS DESDE LA API Y MANTIENE EL FILTRO SELECCIONADO
    function renderCategories(countByCategory) {
      carCatBlock.innerHTML = categoriesFromAPI.map(cat => {
        const qty = countByCategory[cat.categoria] || 0;
        return `
          <div class="car-content${selectedCategory === cat.categoria ? ' selected' : ''}"
            tabindex="0"
            data-category="${cat.categoria}">
            <div style="position:relative;">
              <img src="${cat.imagen || ''}" alt="">
              ${qty > 0 ? `<span class="car-badge">${qty}</span>` : ''}
            </div>
            <div class="car-content-label">${cat.categoria}</div>
          </div>
        `;
      }).join('');
      // Bind click eventos
      Array.from(carCatBlock.querySelectorAll('.car-content')).forEach(el => {
        el.onclick = () => {
          if (selectedCategory === el.dataset.category) {
            selectedCategory = null;
          } else {
            selectedCategory = el.dataset.category;
          }
          renderFilteredAutos();
          renderCategories(countAutosByCategory());
        };
      });
    }

    // FILTRA LOS AUTOS Y LOS RENDERIZA SEGÚN EL TAB Y LA CATEGORÍA SELECCIONADA
    function renderFilteredAutos() {
      // Filtrar por pestaña y categoría
      let disponibles = autosData.filter(a => a.stage === true);
      let vendidos = autosData.filter(a => a.stage === false);
      if (selectedCategory) {
        disponibles = disponibles.filter(a => a.categoria === selectedCategory);
        vendidos = vendidos.filter(a => a.categoria === selectedCategory);
      }
      disponiblesCont.innerHTML = disponibles.length
        ? disponibles.map(a => autoCard(a, false)).join('')
        : '<div class="col-12"><p>No hay autos disponibles.</p></div>';
      vendidosCont.innerHTML = vendidos.length
        ? vendidos.map(a => autoCard(a, true)).join('')
        : '<div class="col-12"><p>No hay autos vendidos.</p></div>';
    }

    // CUENTA CUÁNTOS AUTOS DISPONIBLES HAY POR CATEGORÍA
    function countAutosByCategory() {
      const catCount = {};
      for (const a of autosData) {
        if (a.stage === true) {
          catCount[a.categoria] = (catCount[a.categoria] || 0) + 1;
        }
      }
      return catCount;
    }

    // LLAMA LAS CATEGORÍAS Y LOS AUTOS DESDE SUPABASE
    async function fetchCategoriesAndAutos() {
      const [catRes, autoRes] = await Promise.all([
        fetch(`${SUPABASE_URL}/rest/v1/ocate?select=*`, {
          headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
        }).then(r => r.json()),
        fetch(`${SUPABASE_URL}/rest/v1/ocars?select=*`, {
          headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
        }).then(r => r.json())
      ]);
      // Solo categorías activas y ordenadas por type DESC y nombre ASC
      categoriesFromAPI = catRes
        .filter(cat => cat["INACTIVE"] === false)
        .sort((a, b) =>
          (String(b.type).localeCompare(String(a.type)) || String(a.categoria).localeCompare(String(b.categoria)))
        );
      autosData = autoRes.sort((a, b) => b.id - a.id);
      renderFilteredAutos();
      renderCategories(countAutosByCategory());
    }

    // TABS: Cambia la pestaña entre "Disponibles" y "Vendidos"
    function tabEvents() {
      var descTab = document.getElementById('nav-desc-tab');
      var reviewTab = document.getElementById('nav-review-tab2');
      var tabContent = document.getElementById('nav-tabContent');
      function updateTabBgText() {
        var bg = document.getElementById('tab-bg-text');
        if (!bg) return;
        if (descTab.classList.contains('active')) {
          bg.textContent = 'DISPONIBLES';
        } else if (reviewTab.classList.contains('active')) {
          bg.textContent = 'VENDIDOS';
        }
      }
      descTab.addEventListener('click', function() {
        descTab.classList.add('active');
        reviewTab.classList.remove('active');
        tabSelected = 'disponibles';
        tabContent.querySelector('#nav-desc').classList.add('active', 'show');
        tabContent.querySelector('#nav-review').classList.remove('active', 'show');
        renderFilteredAutos();
        updateTabBgText();
      });
      reviewTab.addEventListener('click', function() {
        reviewTab.classList.add('active');
        descTab.classList.remove('active');
        tabSelected = 'vendidos';
        tabContent.querySelector('#nav-review').classList.add('active', 'show');
        tabContent.querySelector('#nav-desc').classList.remove('active', 'show');
        renderFilteredAutos();
        updateTabBgText();
      });
      updateTabBgText();
    }

    // INIT
    fetchCategoriesAndAutos();
    tabEvents();
  </script>
</body>
</html>
