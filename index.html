<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IAN || Importadora de Autos del Norte">
  <title>IAN</title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/media/favicon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/vendor/slick.css">
  <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
  <link rel="stylesheet" href="assets/css/vendor/datetime.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.date.css">
  <link rel="stylesheet" href="assets/css/vendor/jquery.timepicker.min.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <style>
    .car-content-label {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      margin-top: 0.5em;
      font-weight: 600;
      font-size: 1.5rem;
      line-height: 1.1;
    }
    .car-badge {
      position: absolute;
      right: -1.6em;
      top: -0.8em;
      min-width: 2em;
      height: 2em;
      background: #e60000;
      color: #fff;
      font-weight: 700;
      font-size: 1.25rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      pointer-events: none;
      border: 2px solid #fff;
    }
    .car-content.selected {
      border: 3px solid #FAB637;
      box-shadow: 0 8px 24px rgba(250,182,55,0.14);
    }
    .car-content { cursor:pointer; }
    @media (max-width: 576px) {
      .car-badge { font-size: 1rem; min-width: 1.5em; height: 1.5em; right: -1.1em; top: -0.5em;}
      .car-content-label { font-size: 1.1rem;}
    }
    /* Footer mejora */
    .footer { background: #202020; padding: 18px 0 0; }
    .footer .footer-wrapper { 
      display: flex; align-items: center; 
      justify-content: space-between; flex-wrap: wrap; 
      gap: 10px; 
    }
    .footer img { 
      min-width: 180px; 
      width: 210px;
      max-width: 220px;
      margin-bottom: 0 !important;
      height: auto;
      display: block;
    }
    .footer p { 
      color: #fff; 
      margin-bottom: 0; 
      font-size: 1rem; 
      font-weight: 400;
      letter-spacing: 0.01em;
    }
    @media (max-width:700px) {
      .footer .footer-wrapper { flex-direction:column; align-items:center; gap:0;}
      .footer img { margin-bottom:12px !important;}
      .footer p { text-align:center;}
    }
  </style>
</head>

<body class="tt-smooth-scroll">
  <!-- HEADER MENU START -->
  <header class="header">
    <div class="container-fluid">
      <nav class="navigation d-flex align-items-center justify-content-between py-16">
        <a href="index.html" class="d-flex align-items-center">
          <img src="assets/media/logo.png" alt="/logo" class="header-logo">
        </a>
        <div class="menu-button-right">
          <div class="main-menu__nav">
            <ul class="main-menu__list">
              <li><a href="index.html" class="active">Home</a></li>
              <li><a href="about.html">About Us</a></li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Listing</a>
                <ul>
                  <li> <a href="cars.html">Cars</a></li>
                  <li> <a href="car-details.html">Cars Details</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Pages </a>
                <ul>
                  <li><a href="blogs.html">Blogs</a></li>
                  <li><a href="blogs-2.html">Blogs-2</a></li>
                  <li><a href="blog-list.html">Blog List</a></li>
                  <li><a href="blog-list-2.html">Blog List-2</a></li>
                  <li><a href="blog-detail.html">Blog Detail</a></li>
                  <li><a href="booking.html">Booking Now</a></li>
                  <li><a href="404.html">404 Page</a></li>
                  <li><a href="faq's.html">Faq's</a></li>
                </ul>
              </li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
          </div>
        </div>
        <div class="main-menu__right">
          <div class="search-heart-icon d-sm-flex d-none align-items-center gap-24"></div>
          <a href="" class="d-xl-none d-flex main-menu__toggler mobile-nav__toggler">
            <img src="assets/media/icons/menu-2.png" alt="">
          </a>
        </div>
      </nav>
    </div>
  </header>
  <!-- HEADER MENU END -->

  <section class="hero-banner">
    <div class="container-fluid">
      <div class="hero-content">
        <div class="heading text-lg-start text-center my-4">
          <p class="mb-4 text-white">¿Estás listo para elegir el vehículo que te llevará a la libertad?</p>
          <h4 class="text-white">Elige la libertad. Elige tu vehículo.</h4>
        </div>
      </div>
    </div>
  </section>
  <!-- HERO BANNER END -->

  <!-- CATEGORÍAS DE AUTOS CON BURBUJA -->
  <section class="hero-cars-block">
    <div class="container-fluid">
      <div class="car-block" id="car-categories-block">
        <!-- JS llena aquí las categorías con burbuja -->
      </div>
    </div>
  </section>

  <!-- BLOG Section START -->
  <section class="blog-sec py-80">
    <div class="container-fluid position-relative">
      <div class="d-flex flex-wrap row-gap-4 justify-content-lg-between justify-content-center align-items-end mb-48">
        <div class="heading text-lg-start text-center">
          <h4 class="black"></h4>
        </div>
        <nav class="nav-cotent position-relative" style="z-index:1;">
          <div style="position:relative;display:inline-block;">
            <div class="tab-bg-text-wrapper" style="position:relative;">
              <div id="tab-bg-text" class="tab-bg-text" style="position:absolute;inset:0;z-index:0;pointer-events:none;display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:clamp(2rem,7vw,5rem);font-weight:900;color:#b0b0b0;opacity:0.25;transition:all 0.4s;line-height:1;white-space:nowrap;">
              </div>
              <div class="d-flex gap-16 align-items-center position-relative" style="z-index:1;">
                <div class="nav nav-tabs active reviews" id="nav-tab" role="tablist">
                  <div class="nav-link discription" id="nav-desc-tab" data-bs-toggle="tab" data-bs-target="#nav-desc"
                    role="tab" aria-controls="nav-desc" aria-selected="false">
                    <div>
                      <h6 class="fw-500">Disponibles</h6>
                    </div>
                  </div>
                  <div class="nav-line"></div>
                  <div class="nav-link active reviews" id="nav-review-tab2" data-bs-toggle="tab"
                    data-bs-target="#nav-review" role="tab" aria-controls="nav-review" aria-selected="true">
                    <div>
                      <h6 class="fw-500">Vendidos</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
      <div class="description-wrapper mb-48">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade" id="nav-desc" role="tabpanel" aria-labelledby="nav-desc-tab">
            <div class="row row-gap-4">
              <!-- Autos disponibles se llenan por JS -->
            </div>
          </div>
          <div class="tab-pane fade active show" id="nav-review" role="tabpanel" aria-labelledby="nav-review-tab2">
            <div class="row row-gap-4">
              <!-- Autos vendidos se llenan por JS -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- BLOG ARTICLE Section END -->

  <!-- FOOTER -->
  <footer class="footer">
    <div class="">
      <div class="footer-wrapper">
        <div>
          <img src="assets/media/footer-logo.png" alt="">
        </div>
        <div>
          <p>IAN © 2025 - Todos los derechos reservados.</p>
        </div>
      </div>
    </div>
  </footer>
  <!-- FOOTER END -->

  <!-- Jquery y plugins -->
  <script src="assets/js/vendor/bootstrap.min.js"></script>
  <script src="assets/js/vendor/jquery-3.6.3.min.js"></script>
  <script src="assets/js/vendor/slick.min.js"></script>
  <script src="assets/js/vendor/jquery-validator.js"></script>
  <script src="assets/js/vendor/calendar/popper.min.js"></script>
  <script src="assets/js/vendor/calendar/picker.js"></script>
  <script src="assets/js/vendor/calendar/picker.date.js"></script>
  <script src="assets/js/vendor/jquery.timepicker.min.js"></script>
  <script src="assets/js/date.js"></script>
  <script src="assets/js/app.js"></script>

  <script>
    // SUPABASE
    const SUPABASE_URL = 'https://jxtpcfjmpahguudaksld.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4dHBjZmptcGFoZ3V1ZGFrc2xkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjE4NDgsImV4cCI6MjA2NzMzNzg0OH0.5vSPaIM3cwQGyX0xYnaoRMPkdHIdBq_O6rHqwZWKB0Q';

    let categorias = [];
    let autos = [];
    let categoriaSeleccionada = null;
    let tabActual = 'disponibles';

    const disponiblesCont = document.querySelector('#nav-desc .row');
    const vendidosCont = document.querySelector('#nav-review .row');
    const carCatBlock = document.getElementById('car-categories-block');

    function formatGTPhone(num) {
      num = (num || '').toString().replace(/\D/g,'').slice(-8);
      return num.length === 8 ? `(+502) ${num.slice(0,4)}-${num.slice(4)}` : num;
    }

    function renderCategories(countByCategory) {
      carCatBlock.innerHTML = categorias.map(cat => {
        const qty = countByCategory[cat.categoria] || 0;
        const selected = categoriaSeleccionada === cat.categoria;
        return `
          <div class="car-content${selected ? ' selected' : ''}" data-cat="${cat.categoria}" style="position:relative;">
            <div style="position:relative;">
              <img src="${cat.imagen}" alt="">
              <span class="car-badge">${qty}</span>
            </div>
            <div class="car-content-label">${cat.categoria}</div>
          </div>
        `;
      }).join('');

      // Clic para filtrar
      document.querySelectorAll('.car-content').forEach(el => {
        el.onclick = () => {
          const cat = el.getAttribute('data-cat');
          categoriaSeleccionada = (categoriaSeleccionada === cat ? null : cat);
          renderCategoriasYAutos();
        };
      });
    }

    function renderAutos() {
      const cont = tabActual === 'disponibles' ? disponiblesCont : vendidosCont;
      const autosFiltrados = autos
        .filter(a => (tabActual === 'disponibles' ? a.stage : !a.stage))
        .filter(a => !categoriaSeleccionada || a.categoria === categoriaSeleccionada)
        .sort((a,b) => b.id - a.id);
      cont.innerHTML = autosFiltrados.length ? autosFiltrados.map(a => autoCard(a, tabActual === 'vendidos')).join('') : `<div class="col-12"><p>No hay autos en esta categoría.</p></div>`;
    }

    function getCountByCategory() {
      const count = {};
      autos.forEach(a => {
        if ((tabActual === 'disponibles' && a.stage) || (tabActual === 'vendidos' && !a.stage)) {
          count[a.categoria] = (count[a.categoria] || 0) + 1;
        }
      });
      return count;
    }

    function autoCard(auto, vendido = false) {
      const whatsappMsg = encodeURIComponent(`Hola, estoy interesado en el vehículo ${auto.nombre}`);
      return `
      <div class="col-xxl-3 col-xl-4 col-sm-6">
        <div class="blog-1">
          <div class="blog-img" style="position:relative;">
            ${vendido ? `<span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);background:rgba(220,53,69,0.85);color:#fff;font-size:clamp(1.5rem,4vw,2rem);font-weight:900;padding:0.5em 1.7em;border-radius:0.3em;z-index:2;pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);letter-spacing:0.1em;white-space:nowrap;">VENDIDO</span>` : ''}
            <a href="car-details.html">
              <img src="${auto.imagen || 'assets/media/blog/blog-1.jpg'}" alt="${auto.nombre || ''}" style="${vendido ? 'opacity:0.25;' : ''}">
            </a>
          </div>
          <div class="blog-content">
            <p class="subtitle black mb-4">${auto.categoria || ''}</p>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <a href="car-details.html" class="h6 hover-content fw-500 black">${auto.nombre || ''}</a>
              <h5 class="fw-600 color-primary">${auto.precio || ''}</h5>
            </div>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/manual-transmission.png" alt="">
                  <p class="fw-600 black">${auto.transmision || ''}</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/disc-brake.png" alt="">
                  <p class="fw-600 black">${auto.descripcion || ''}</p>
                </div>
              </div>
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/speedometer.png" alt="">
                  <p class="fw-600 black">${auto.kms || ''} Kms</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/fuel.png" alt="">
                  <p class="fw-600 black">${auto.combustible || ''}</p>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                ${vendido
                  ? `<span style="color:#E60012;font-weight:600;">VENDIDO</span>`
                  : `<span style="font-weight:400;">Whatsapp: <span class="fw-600">${formatGTPhone(auto.whatsapp)}</span></span>`
                }
              </div>
              <div>
                ${vendido
                  ? `<i class="fa-brands fa-whatsapp" style="color:#AAA;font-size:2.3em;opacity:.4;cursor:not-allowed;"></i>`
                  : `<a href="https://wa.me/502${auto.whatsapp}?text=${whatsappMsg}" target="_blank" title="Contáctame por WhatsApp" style="margin-left:8px;">
                      <i class="fa-brands fa-whatsapp" style="color:#25D366;font-size:2.3em;"></i>
                    </a>`
                }
              </div>
            </div>
          </div>
        </div>
      </div>
      `;
    }

    async function fetchCategorias() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/ocate?select=*`, {
        headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
      });
      let data = await res.json();
      categorias = data.filter(c => !c.INACTIVE)
        .sort((a,b) => {
          if ((b.type||'').localeCompare(a.type||'')!==0)
            return (b.type||'').localeCompare(a.type||'');
          return (a.categoria||'').localeCompare(b.categoria||'');
        });
    }
    async function fetchAutos() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/ocars?select=*`, {
        headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY }
      });
      autos = await res.json();
    }

    function renderCategoriasYAutos() {
      renderCategories(getCountByCategory());
      renderAutos();
    }

    function bindTabs() {
      const descTab = document.getElementById('nav-desc-tab');
      const reviewTab = document.getElementById('nav-review-tab2');
      const bg = document.getElementById('tab-bg-text');
      function updateTabBgText() {
        if (!bg) return;
        if (descTab.classList.contains('active')) bg.textContent = 'DISPONIBLES';
        else if (reviewTab.classList.contains('active')) bg.textContent = 'VENDIDOS';
      }
      descTab && descTab.addEventListener('click', function() {
        descTab.classList.add('active');
        reviewTab.classList.remove('active');
        tabActual = 'disponibles';
        categoriaSeleccionada = null; // Mostrar todas al cambiar tab
        renderCategoriasYAutos();
        updateTabBgText();
      });
      reviewTab && reviewTab.addEventListener('click', function() {
        reviewTab.classList.add('active');
        descTab.classList.remove('active');
        tabActual = 'vendidos';
        categoriaSeleccionada = null; // Mostrar todas al cambiar tab
        renderCategoriasYAutos();
        updateTabBgText();
      });
      // Por defecto: activa Disponibles al cargar
      descTab.classList.add('active');
      reviewTab.classList.remove('active');
      tabActual = 'disponibles';
      categoriaSeleccionada = null;
      updateTabBgText();
    }

    async function init() {
      await fetchCategorias();
      await fetchAutos();
      bindTabs();
      renderCategoriasYAutos();
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
