<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IAN || Importadora de Autos del Norte">

  <title>IAN</title>

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="assets/media/favicon.png">

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- All CSS files -->
  <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/vendor/slick.css">
  <link rel="stylesheet" href="assets/css/vendor/slick-theme.css">
  <link rel="stylesheet" href="assets/css/vendor/datetime.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.css">
  <link rel="stylesheet" href="assets/css/vendor/classic.date.css">
  <link rel="stylesheet" href="assets/css/vendor/jquery.timepicker.min.css">
  <link rel="stylesheet" href="assets/css/app.css">

  <style>
    .notif-bubble {
      display: inline-block;
      position: absolute;
      top: 12px;
      right: 20px;
      background: #e50000;
      color: #fff;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 50%;
      min-width: 28px;
      min-height: 28px;
      line-height: 28px;
      text-align: center;
      z-index: 10;
      box-shadow: 0 1px 8px rgba(0,0,0,0.13);
      padding: 0 7px;
      pointer-events: none;
    }
    .car-content { position: relative; }
  </style>
</head>

<body class="tt-smooth-scroll">

  <!-- HEADER MENU START -->
  <header class="header">
    <div class="container-fluid">
      <nav class="navigation d-flex align-items-center justify-content-between py-16">
        <a href="index.html" class="d-flex align-items-center">
          <img src="assets/media/logo.png" alt="/logo" class="header-logo">
        </a>
        <div class="menu-button-right">
          <div class="main-menu__nav">
            <ul class="main-menu__list">
              <li>
                <a href="index.html" class="active">Home</a>
              </li>
              <li>
                <a href="about.html">About Us</a>
              </li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Listing</a>
                <ul>
                  <li> <a href="cars.html">Cars</a></li>
                  <li> <a href="car-details.html">Cars Details</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="javascript:void(0); ">Pages </a>
                <ul>
                  <li><a href="blogs.html">Blogs</a></li>
                  <li><a href="blogs-2.html">Blogs-2</a></li>
                  <li><a href="blog-list.html">Blog List</a></li>
                  <li><a href="blog-list-2.html">Blog List-2</a></li>
                  <li><a href="blog-detail.html">Blog Detail</a></li>
                  <li><a href="booking.html">Booking Now</a></li>
                  <li><a href="404.html">404 Page</a></li>
                  <li><a href="faq's.html">Faq's</a></li>
                </ul>
              </li>
              <li>
                <a href="contact.html">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="main-menu__right">
          <div class="search-heart-icon d-sm-flex d-none align-items-center gap-24"></div>
          <a href="" class="d-xl-none d-flex main-menu__toggler mobile-nav__toggler">
            <img src="assets/media/icons/menu-2.png" alt="">
          </a>
        </div>
      </nav>
    </div>
  </header>
  <!-- HEADER MENU END -->

  <section class="hero-banner">
    <div class="container-fluid">
      <div class="hero-content">
        <div class="heading text-lg-start text-center my-4">
          <p class="mb-4 text-white">¿Estás listo para elegir el vehículo que te llevará a la libertad?</p>
          <h4 class="text-white">Elige la libertad. Elige tu vehículo.</h4>
        </div>
      </div>
    </div>
  </section>
  <!-- HERO BANNER END -->

  <!-- BLOQUE DE CATEGORÍAS DINÁMICO -->
  <section class="hero-cars-block">
    <div class="container-fluid">
      <div class="car-block" id="category-block">
        <!-- Se llena por JS -->
      </div>
    </div>
  </section>

  <!-- BLOG Section START -->
  <section class="blog-sec py-80">
    <div class="container-fluid position-relative">
      <div class="d-flex flex-wrap row-gap-4 justify-content-lg-between justify-content-center align-items-end mb-48">
        <div class="heading text-lg-start text-center">
          <h4 class="black"></h4>
        </div>
        <nav class="nav-cotent position-relative" style="z-index:1;">
          <div style="position:relative;display:inline-block;">
            <div class="tab-bg-text-wrapper" style="position:relative;">
              <div id="tab-bg-text" class="tab-bg-text" style="position:absolute;inset:0;z-index:0;pointer-events:none;display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:clamp(2rem,7vw,5rem);font-weight:900;color:#b0b0b0;opacity:0.25;transition:all 0.4s;line-height:1;white-space:nowrap;">
              </div>
              <div class="d-flex gap-16 align-items-center position-relative" style="z-index:1;">
                <div class="nav nav-tabs active reviews" id="nav-tab" role="tablist">
                  <div class="nav-link discription" id="nav-desc-tab" data-bs-toggle="tab" data-bs-target="#nav-desc"
                    role="tab" aria-controls="nav-desc" aria-selected="false">
                    <div>
                      <h6 class="fw-500">Disponibles</h6>
                    </div>
                  </div>
                  <div class="nav-line"></div>
                  <div class="nav-link active reviews" id="nav-review-tab2" data-bs-toggle="tab"
                    data-bs-target="#nav-review" role="tab" aria-controls="nav-review" aria-selected="true">
                    <div>
                      <h6 class="fw-500">Vendidos</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
      <div class="description-wrapper mb-48">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade" id="nav-desc" role="tabpanel" aria-labelledby="nav-desc-tab">
            <div class="row row-gap-4">
              <!-- Autos disponibles se llenan por JS -->
            </div>
          </div>
          <div class="tab-pane fade active show" id="nav-review" role="tabpanel" aria-labelledby="nav-review-tab2">
            <div class="row row-gap-4">
              <!-- Autos vendidos se llenan por JS -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- BLOG ARTICLE Section END -->

  <!-- FOOTER START (simplificado) -->
  <footer class="footer">
    <div class="">
      <div class="footer-wrapper">
        <div class="footer-sec-1">
          <div class="mb-96">
            <img class="mb-24" src="assets/media/footer-logo.png" alt="">
            <p class="fw-600 lightest-gray mb-48">IAN © 2025 - Todos los derechos reservados.</p>
            <a href="contact.html" class="cus-btn-2">Contáctanos</a>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- FOOTER END -->

  <!-- Jquery y plugins (según tu template) -->
  <script src="assets/js/vendor/bootstrap.min.js"></script>
  <script src="assets/js/vendor/jquery-3.6.3.min.js"></script>
  <script src="assets/js/vendor/slick.min.js"></script>
  <script src="assets/js/vendor/jquery-validator.js"></script>
  <script src="assets/js/vendor/calendar/popper.min.js"></script>
  <script src="assets/js/vendor/calendar/picker.js"></script>
  <script src="assets/js/vendor/calendar/picker.date.js"></script>
  <script src="assets/js/vendor/jquery.timepicker.min.js"></script>
  <script src="assets/js/date.js"></script>
  <script src="assets/js/app.js"></script>

  <!-- BLOQUE DINÁMICO DE CATEGORÍAS + BLOGS CON SUPABASE -->
  <script>
    // ============ CONFIG SUPABASE ============
    const SUPABASE_URL = 'https://jxtpcfjmpahguudaksld.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4dHBjZmptcGFoZ3V1ZGFrc2xkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjE4NDgsImV4cCI6MjA2NzMzNzg0OH0.5vSPaIM3cwQGyX0xYnaoRMPkdHIdBq_O6rHqwZWKB0Q';

    // CATEGORÍAS QUE MOSTRAR Y SU ICONO
    const CATEGORIES = [
      { label: "Motocicletas", icon: "assets/media/hero/moto.png", key: "Motocicleta" },
      { label: "Sedan", icon: "assets/media/hero/sedan.png", key: "Sedan" },
      { label: "Coupe", icon: "assets/media/hero/cabriolet.png", key: "Coupe" },
      { label: "SUV", icon: "assets/media/hero/suv.png", key: "SUV" },
      { label: "Sports Car", icon: "assets/media/hero/sport-car.png", key: "Sports Car" },
      { label: "Mini Van", icon: "assets/media/hero/van.png", key: "Mini Van" },
    ];

    // ==================== HERO CARS BLOCK =====================
    async function renderCategories() {
      // Traer autos para contar por categoría y solo los disponibles (stage true)
      const response = await fetch(`${SUPABASE_URL}/rest/v1/ocars?select=categoria,stage`, {
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: 'Bearer ' + SUPABASE_KEY
        }
      });
      const cars = await response.json();
      // Solo cuenta autos disponibles (stage true)
      const categoryCounts = {};
      cars.forEach(car => {
        if (car.stage === true) {
          if (!categoryCounts[car.categoria]) categoryCounts[car.categoria] = 0;
          categoryCounts[car.categoria]++;
        }
      });

      // Renderizar
      const block = document.getElementById('category-block');
      block.innerHTML = CATEGORIES.map(cat => `
        <a href="cars.html" class="car-content">
          <div style="position:relative;">
            <img src="${cat.icon}" alt="">
            ${
              (categoryCounts[cat.key])
                ? `<span class="notif-bubble">${categoryCounts[cat.key]}</span>`
                : ''
            }
          </div>
          <div>
            <h6 class="">${cat.label}</h6>
          </div>
        </a>
      `).join('');
    }

    // ==================== AUTOS DISPONIBLES/VENDIDOS =====================
    const disponiblesCont = document.querySelector('#nav-desc .row');
    const vendidosCont = document.querySelector('#nav-review .row');

    function autoCard(auto, vendido = false) {
      return `
      <div class="col-xxl-3 col-xl-4 col-sm-6">
        <div class="blog-1">
          <div class="blog-img" style="position:relative;">
            ${vendido ? `
              <span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-20deg);background:rgba(220,53,69,0.85);color:#fff;font-size:clamp(1.5rem,4vw,2rem);font-weight:900;padding:0.5em 1.7em;border-radius:0.3em;z-index:2;pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);letter-spacing:0.1em;white-space:nowrap;">VENDIDO</span>
            ` : ''}
            <a href="car-details.html">
              <img src="${auto.imagen || 'assets/media/blog/blog-1.jpg'}" alt="${auto.nombre || ''}" style="${vendido ? 'opacity:0.25;' : ''}">
            </a>
          </div>
          <div class="blog-content">
            <p class="subtitle black mb-4">${auto.categoria || ''}</p>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <a href="car-details.html" class="h6 hover-content fw-500 black">${auto.nombre || ''}</a>
              <h5 class="fw-600 color-primary">${auto.precio || ''}</h5>
            </div>
            <div class="d-flex align-items-center justify-content-between mb-36">
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/manual-transmission.png" alt="">
                  <p class="fw-600 black">${auto.transmision || ''}</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/disc-brake.png" alt="">
                  <p class="fw-600 black">${auto.descripcion || ''}</p>
                </div>
              </div>
              <div>
                <div class="d-flex align-items-center gap-16 mb-16">
                  <img src="assets/media/icons/speedometer.png" alt="">
                  <p class="fw-600 black">${auto.kms || ''} Kms</p>
                </div>
                <div class="d-flex align-items-center gap-16">
                  <img src="assets/media/icons/fuel.png" alt="">
                  <p class="fw-600 black">${auto.combustible || ''}</p>
                </div>
              </div>
            </div>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <p class="black">Whatsapp: <span class="fw-600">${auto.whatsapp || ''}</span></p>
              </div>
              <div>
                <a href="https://wa.me/502${auto.whatsapp || ''}" target="_blank" class="text-decoration-underline p hover-content" title="Contáctame por WhatsApp">
                  <i class="fa-brands fa-whatsapp" style="color:#25D366;font-size:1.5em;"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      `;
    }

    function cargarAutos() {
      fetch(`${SUPABASE_URL}/rest/v1/ocars?select=*`, {
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: 'Bearer ' + SUPABASE_KEY
        }
      })
      .then(res => res.json())
      .then(data => {
        const disponibles = data.filter(a => a.stage === true);
        const vendidos = data.filter(a => a.stage === false);
        disponiblesCont.innerHTML = disponibles.length ? disponibles.map(a => autoCard(a, false)).join('') : '<div class="col-12"><p>No hay autos disponibles.</p></div>';
        vendidosCont.innerHTML = vendidos.length ? vendidos.map(a => autoCard(a, true)).join('') : '<div class="col-12"><p>No hay autos vendidos.</p></div>';
      });
    }

    // --------- Control visual de pestañas ---------
    function updateTabBgText() {
      var descTab = document.getElementById('nav-desc-tab');
      var reviewTab = document.getElementById('nav-review-tab2');
      var bg = document.getElementById('tab-bg-text');
      if (!bg) return;
      if (descTab.classList.contains('active')) {
        bg.textContent = 'DISPONIBLES';
      } else if (reviewTab.classList.contains('active')) {
        bg.textContent = 'VENDIDOS';
      }
    }
    var descTab = document.getElementById('nav-desc-tab');
    var reviewTab = document.getElementById('nav-review-tab2');
    descTab && descTab.addEventListener('click', function() {
      descTab.classList.add('active');
      reviewTab.classList.remove('active');
      updateTabBgText();
    });
    reviewTab && reviewTab.addEventListener('click', function() {
      reviewTab.classList.add('active');
      descTab.classList.remove('active');
      updateTabBgText();
    });
    updateTabBgText();

    // --- Inicializar
    renderCategories();
    cargarAutos();
  </script>

</body>
</html>
